---
layout: post
title: "Remoting over Apache Kafka plugin with Kafka launcher in Kubernetes"
tags:
- remoting
- kafka
- kubernetes
- helm
- developer
- gsoc
- gsoc2019
author: longnguyen
---

= Remoting over Apache Kafka plugin with Kafka launcher in Kubernetes

== Introduction

Current version of Remoting over Apache Kafka plugin requires users to manually configure the entire system which includes Zookeeper, Kafka and remoting agents. It also doesn't support dynamic agent provisioning so scalability is harder to achieve. This project aims to solve two problems:

. Out-of-the-box solution to provision Apache Kafka cluster.

. Dynamic agent provisioning in a Kubernetes cluster.

== Current State

* Kubernetes connector with credentials supported.

* Apache Kafka provisioning in Kubernetes feature is fully implemented.

* Helm chart is partially implemented.

== Apache Kafka provisioning in Kubernetes

This feature is part of 2.0 version so it is not yet released officially. You can try out the feature by building directly from master branch:

[source, bash]
----
git clone https://github.com/jenkinsci/remoting-kafka-plugin.git
cd remoting-kafka-plugin/plugin
mvn hpi:run
----

On the Global Configuration page, users can input Kubernetes server information and credentials. Then they can start Apache Kafka with only one button click.

image:/images/post-images/remoting-kafka/kafka-provisioning-kubernetes-ui.png[Kafka provisioning in Kubernetes UI]

When users click `Start Kafka on Kubernetes` button, Jenkins will create a Kubernetes client from the information and then apply Zookeeper and Kafka YAML specification files from `resources`.

image:/images/post-images/remoting-kafka/kafka-provisioning-kubernetes-architecture.png[Kafka provisioning in Kubernetes architecture]

== Helm Chart

Helm chart for Remoting over Apache Kafka plugin is based on link:https://github.com/helm/charts/tree/master/stable/jenkins[stable/jenkins] chart and link:https://github.com/helm/charts/tree/master/incubator/kafka[incubator/kafka] chart. As of now, the chart is still a link:https://github.com/jenkinsci/remoting-kafka-plugin/pull/62[Work in Progress] because it is still waiting for Cloud API implementation in Phase 2. However, you can check out the demo chart with a single standalone Remoting Kafka Agent:

[source, bash]
----
git clone -b demo-helm-phase-1 https://github.com/longngn/remoting-kafka-plugin.git
cd remoting-kafka-plugin
K8S_NODE=<your Kubernetes node IP> ./helm/jenkins-remoting-kafka/do.sh start
----

The command `do.sh start` will install the chart (with Jenkins and Kafka), launch a Kafka computer on Jenkins master by applying JCasC, then launch a single Remoting Kafka Agent pod.

== Next Phase Plan

* Implement Cloud API to provision Remoting Kafka Agent. (link:https://issues.jenkins-ci.org/browse/JENKINS-57668[JENKINS-57668])

* Integrate Cloud API implementation with Helm chart. (link:https://issues.jenkins-ci.org/browse/JENKINS-58288[JENKINS-58288])

* Unit tests and integration tests.

* Release version 2.0 and address feedbacks. (link:https://issues.jenkins-ci.org/browse/JENKINS-58289[JENKINS-58289])

== Links

* link:https://youtu.be/MDs0Vr7gnnA?t=2601[Phase 1 Demo Video]
* link:https://docs.google.com/presentation/d/1yIPwwL7P051XaSE2EOJYAtbVsd6YvGvvKp9QcJE4J1Y/edit?usp=sharing[Phase 1 Presentation Slides]
* link:https://github.com/jenkinsci/remoting-kafka-plugin[Remoting over Apache Kafka plugin]
* link:https://jenkins.io/projects/gsoc/2019/remoting-over-apache-kafka-docker-k8s-features/[Project Page]
* link:https://gitter.im/jenkinsci/remoting[Gitter Channel]
