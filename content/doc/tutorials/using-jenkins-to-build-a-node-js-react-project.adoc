---
layout: documentation
title: Using Jenkins to build a Node.js/React project
section: doc
---

:toc:
:imagesdir: /doc/book/resources

This tutorial shows you how to build a simple
https://nodejs.org/en/[Node.js]/&zwj;https://reactjs.org/[React] application
using the https://www.npmjs.com/[Node Package Manager (npm)], whose overall
build process will be orchestrated in Jenkins.

If you are a Node.js/React developer who is new to CI/CD concepts, or you might
be familiar with these concepts but don't know how to implement building your
project using Jenkins, then this tutorial is for you.

The simple Node.js/React application (which you'll obtain from a sample
repository on GitHub) generates a web page with the content "Welcome to React"
and is accompanied by a test to check that the application renders
satisfactorily.

*Duration:* This tutorial takes 20-40 minutes to complete (assuming you've
already met the <<prerequisites,prerequisites>> below). The exact duration will
depend on the speed of your machine and whether or not you've already
<<download-and-run-jenkins-in-docker,downloaded and run Jenkins in Docker>> from
link:..[another introductory tutorial].

You can stop this tutorial at any point in time and continue from where you left
off.

include::doc/tutorials/_prerequisites.adoc[]

include::doc/tutorials/_download-and-run-jenkins-in-docker.adoc[]


=== Fork and clone the sample repository on GitHub

Obtain the simple "Welcome to React" Node.js/React application from GitHub, by
forking the sample repository of the application's source code into your own
GitHub account and then cloning this fork locally.

. Ensure you are signed in to your GitHub account. If you don't yet have a GitHub account,
  sign up for a free one on the https://github.com/[GitHub website].
. Fork the
  https://github.com/gilesgas/simple-node-js-react-app[`simple-node-js-react-app`]
  on GitHub into your local GitHub account. If you need help with this process,
  refer to the https://help.github.com/articles/fork-a-repo/[Fork A Repo]
  documentation on the GitHub website for more information.
. Begin cloning your forked `simple-node-js-react-app` repository (on GitHub)
  locally to your machine by opening up a terminal/command line window to the
  directory in which the repository will be cloned. This tutorial assumes that
  `simple-node-js-react-app` will be cloned within the following directories on
  these platforms, which you should `cd` into now:
* macOS - `/Users/<your-username>/Documents/GitHub`
* Linux - `/home/<your-username>/GitHub`
* Windows - `C:\Users\<your-username>\Documents\GitHub`

+
where `<your-username>` is your user account's name on your operating system.

+
*Note:*

** On a Windows machine, use a Git bash command line window (as opposed to the
   usual Microsoft command prompt).
** Alternatively, and in particular if you have the GitHub Desktop app installed
   on your machine, in GitHub, you can click the green *Clone or download*
   button on your forked repository and follow the instructions to clone the
   repository locally. If you use GitHub Desktop, you can omit the following
   step.

+
. Run the following command to continue/complete cloning your forked repo: +
  `git clone https://github.com/YOUR-GITHUB-ACCOUNT-NAME/simple-node-js-react-app` +
  where `YOUR-GITHUB-ACCOUNT-NAME` is the name of your GitHub account.


=== Create your Pipeline project in Jenkins

. Go back to Jenkins, log in again if necessary and click *create new jobs*
  under *Welcome to Jenkins!* +
  *Note:* If you don't see this, click *New Item* at the top left.
. In the *Enter an item name* field, specify the name for your new Pipeline
  project (e.g. `simple-node-js-react-app`).
. Scroll down and click *Pipeline*, then click *OK* at the end of the page.
. ( _Optional_ ) On the next page, specify a brief description for your Pipeline
  in the *Description* field (e.g. `An entry-level Pipeline demonstrating how to
  build a simple Node.js/React project using Jenkins.`)
. Click the *Pipeline* tab at the top of the page to scroll down to the
  *Pipeline* section.
. From the *Definition* field, choose the *Pipeline script from SCM* option.
  This option instructs Jenkins to obtain your Pipeline from Source Control
  Management (SCM), which will be your locally cloned Git repository.
. From the *SCM* field, choose *Git*.
. In the *Repository URL* field, specify the directory path of your locally
  cloned repository <<fork-and-clone-the-sample-repository-on-github,above>>,
  which is from your user account/home directory on your host machine, mapped to
  the `/home` directory of the Jenkins/Blue Ocean container - i.e.
* For macOS - `/home/Documents/GitHub/simple-node-js-react-app`
* For Linux - `/home/GitHub/simple-node-js-react-app`
* For Windows - `/home/Documents/GitHub/simple-node-js-react-app`
. Click *Save* to save your new Pipeline project. You're now ready to begin
  creating your `Jenkinsfile`, which you'll be checking into your locally cloned
  Git repository.


=== Create your initial Pipeline as a Jenkinsfile

You're now ready to create your Pipeline that will automate building your
Node.js/React project in Jenkins. Your Pipeline will be created as a
`Jenkinsfile`, which will be committed to your locally cloned Git repository
(`simple-node-js-react-app`).

This is the foundation of "Pipeline-as-Code", which treats the continuous
delivery pipeline a part of the application to be versioned and reviewed like
any other code. Read more about Pipeline and what a Jenkinsfile is in the
link:/doc/book/pipeline[Pipeline] and link:/doc/book/pipeline/jenkinsfile[Using
a Jenkinsfile] sections of the User Handbook.

First, create an initial Pipeline to download a Node Docker image and run it as
a Docker container (which will build your simple Node.js/React application).
Also add a "Build" stage to the Pipeline that begins orchestrating this whole
process.

. Using your favorite text editor or IDE, create and save new text file with the
  name `Jenkinsfile` at the root of your local `simple-node-js-react-app` Git
  repository.
. Copy the following Declarative Pipeline code and paste it into your empty
  `Jenkinsfile`:
+
[source,groovy]
----
pipeline {
    agent {
        docker {
            image 'node:6-alpine' // <1>
            args '-p 3000:3000' // <2>
        }
    }
    stages {
        stage('Build') { // <3>
            steps {
                sh 'npm install' // <4>
            }
        }
    }
}
----
<1> This `image` parameter (of the link:/doc/book/pipeline/syntax#agent[`agent`]
section's `docker` parameter) downloads the
https://hub.docker.com/_/node/[`node:6-apline` Docker image] (if it's not
already available in your Docker host) and runs this image as a separate
container. This means that:
* You'll have separate Jenkins/Blue Ocean and Node containers running locally in
  Docker.
* The Node container becomes the link:/doc/book/glossary/#agent[agent] that
  Jenkins uses to build your Pipeline project. However, this container is
  short-lived - its lifespan is only that of the duration of your Pipeline's
  execution.
<2> This `args` parameter makes the Node container (temporarily) accessible
through port 3000. The significance of this is explained in the
`jenkins/scripts/deliver.sh` file of your cloned repository, and is covered in a
subsequent section of this tutorial.
<3> Defines a stage called `Build` that appears on the Jenkins UI.
<4> This `sh` step (of the link:/doc/book/pipeline/syntax/#steps[`steps`]
section) executes the `npm` command to ensure that all dependencies required to
run your application have been downloaded to the local `node_modules` directory
(i.e. within the `/var/jenkins_home/workspace/simple-node-js-react-app`
directory in the Jenkins/Blue Ocean container).
+
. Save your amended `Jenkinsfile` and commit it to your local
  `simple-node-js-react-app` Git repository. E.g. Within the
  `simple-node-js-react-app` directory, run the commands: +
  `git add .` +
  then +
  `git commit -m "Add initial Jenkinsfile"`
. Go back to Jenkins again, log in again if necessary and click *Open Blue
  Ocean* on the left to access Jenkins's Blue Ocean interface.
. In the *This job has not been run* message box, click *Run*, then quickly
  click the *OPEN* link which appears briefly at the lower-right to see Jenkins
  building your Pipeline project. If you weren't able to click the *OPEN* link,
  click the row on the main Blue Ocean interface to access this feature.

+
*Note:* You may need to wait several minutes for this first run to complete.
After making a clone of your local `simple-node-js-react-app` Git repository
itself, Jenkins:

.. Initially queues the project to be built on the agent.
.. Downloads the Node Docker image and runs it in a container on Docker. +
   image:tutorials/java-maven-01-downloading-maven-docker-image.png[alt="Downloading
   Node Docker image",width=100%]
.. Executes the `Build` stage (defined in the `Jenkinsfile`) on the Maven
   container. During this time, `npm` will download many dependencies necessary
   to run your Node.js/React application, which will ultimately be stored in the
   local `node_modules` directory (within the Jenkins home directory). +
   image:tutorials/java-maven-02-initial-pipeline-downloading-maven-artifacts.png[alt="Downloading
   'npm' dependencies",width=100%]

+
The Blue Ocean interface turns green if Jenkins built your Node.js/React
application successfully. +
image:tutorials/java-maven-03-initial-pipeline-runs-successfully.png[alt="Initial
Pipeline runs successfully",width=100%]

. Click the *X* at the top-right to return to the main Blue Ocean interface.

+
image:tutorials/java-maven-05-main-blue-ocean-interface.png[alt="Main Blue Ocean
interface",width=100%]


=== Add a test stage to your Pipeline

. Go back to your text editor/IDE and ensure your `Jenkinsfile` is open.
. Copy and paste the following Declarative Pipeline syntax immediately under the
  `agent` section of your `Jenkinsfile`:
+
[source,groovy]
----
    environment {
        CI = 'true'
    }
----
+
as well as the following immediately under the `Build` stage:
+
[source,groovy]
----
        stage('Test') {
            steps {
                sh 'npm test'
            }
        }
----
+
so that you end up with:
+
[source,groovy]
----
pipeline {
    agent {
        docker {
            image 'node:6-alpine'
            args '-p 3000:3000'
        }
    }
    environment {
        CI = 'true' // <1>
    }
    stages {
        stage('Build') {
            steps {
                sh 'npm install'
            }
        }
        stage('Test') { // <2>
            steps {
                sh './jenkins/scripts/test.sh' // <3>
            }
        }
    }
}
----
+
<1> The link:/doc/book/pipeline/syntax#environment[`environment`] directive sets
the environment variable `CI` with a boolean value of `true`, which is available
to all steps in this Pipeline. When the `npm test` command in `test.sh` (which
is run during the `Test` stage defined further down the Pipeline) detects the
environment variable `CI` with a value of `true`, then this command is run in
"non-watch" (i.e. non-interactive) mode. In "watch" mode, `npm test` expects
user input, which can pause running builds of CI/CD applications indefinitely.
As an alternative to specifying the `environment` directive in a Jenkins
Pipeline, you could also specify this environment variable in the `package.json`
file by:
.. Uncommenting the `npm install --save-dev cross-env` command in
   `jenkins/scripts/test.sh` (to install the `cross-env` dependency during the
   `Test` stage). Read more about this in the `test.sh` file itself.
.. Updating the following line in the `package.json` file from:
   * `"test": "react-scripts test --env=jsdom"` +
     to
   * `"test": "cross-env CI=true react-scripts test --env=jsdom"`
<2> Defines a new stage called `Test` that appears on the Jenkins UI.
<3> This `sh` step (of the link:/doc/book/pipeline/syntax/#steps[`steps`]
section) runs the shell script `test.sh` located in the `jenkins/scripts`
directory from the root of the `simple-node-js-react-app` repository.
Explanations about what this script does are covered in the `test.sh` file
itself. As a general principle, it's a good idea to keep your Pipeline code
(i.e. the `Jenkinsfile`) as tidy as possible and place more complex build
scripting steps into separate shell script files like the `test.sh` file. This
ultimately facilitates the maintenance of your Pipeline, especially if it gains
more complexity.
+
. Save your amended `Jenkinsfile` and commit it to your local
  `simple-node-js-react-app` Git repository. E.g. Within the
  `simple-node-js-react-app` directory, run the commands: +
  `git stage .` +
  then +
  `git commit -m "Add 'Test' stage"`
. Go back to Jenkins again, log in again if necessary and ensure you've accessed
  Jenkins's Blue Ocean interface.
. Click *Run* at the top left, then quickly click the *OPEN* link which appears
  briefly at the lower-right to see Jenkins building your amended Pipeline
  project. If you weren't able to click the **OPEN** link, click the _top_ row
  on the Blue Ocean interface to access this feature.

+
*Note:* You'll notice from this run that Jenkins no longer needs to download the
Node Docker image. Instead, Jenkins only needs to run a new container from the
Node image downloaded previously. Also, from now on, no (new) `npm` dependencies
should need to be downloaded during the "Build" stage. Therefore, running your
Pipeline this subsequent time should be much faster. +
If your amended Pipeline ran successfully, here's what the Blue Ocean interface
should look like. Notice the additional "Test" stage. You can click on the
previous "Build" stage circle to access the output from that stage. +
image:tutorials/java-maven-12-test-stage-runs-successfully-with-output.png[alt="Test
stage runs successfully (with output)",width=100%]

+
. Click the *X* at the top-right to return to the main Blue Ocean interface.


=== Add a final deliver stage to your Pipeline

. Go back to your text editor/IDE and ensure your `Jenkinsfile` is open.
. Copy and paste the following Declarative Pipeline syntax immediately under the
  `Test` stage of your `Jenkinsfile`:
+
[source,groovy]
----
        stage('Deliver') {
            steps {
                sh './jenkins/scripts/deliver.sh'
                input message:'Finished using the web site? (Click “Proceed” to continue)'
                sh './jenkins/scripts/kill.sh'
            }
        }
----
+
so that you end up with:
+
[source,groovy]
----
pipeline {
    agent {
        docker {
            image 'node:6-alpine'
            args '-p 3000:3000'
        }
    }
    environment { // <1>
        CI = 'true'
    }
    stages {
        stage('Build') {
            steps {
                sh 'npm install'
            }
        }
        stage('Test') {
            steps {
                sh './jenkins/scripts/test.sh'
            }
        }
        stage('Deliver') { // <2>
            steps {
                sh './jenkins/scripts/deliver.sh' // <3>
                input message:'Finished using the web site? (Click “Proceed” to continue)' // <4>
                sh './jenkins/scripts/kill.sh' // <5>
            }
        }
    }
}
----
+
<1> This link:/doc/book/pipeline/syntax#environment[`environment`] directive
might not be present in your Pipeline if you chose to specify the `CI`
environment variable in the `package.json` file
<<add-a-test-stage-to-your-pipeline,above>>.
<2> Defines a new stage called `Deliver` that appears on the Jenkins UI.
<3> This `sh` step (of the link:/doc/book/pipeline/syntax/#steps[`steps`]
section) runs the shell script `deliver.sh` located in the `jenkins/scripts`
directory from the root of the `simple-node-js-react-app` repository.
Explanations about what this script does are covered in the `deliver.sh` file
itself.
<4> This `input` step (of the
link:/doc/pipeline/steps/pipeline-input-step[Pipeline: Input Step] plugin)
pauses the running build prompts the user (with a custom message) to proceed or
abort.
<5> This `sh` step (of the `steps` section) runs the shell script `kill.sh`
located in the `jenkins/scripts` directory. Explanations about what this script
does are covered in the `kill.sh` file itself.

+
. Save your amended `Jenkinsfile` and commit it to your local
  `simple-node-js-react-app` Git repository. E.g. Within the
  `simple-node-js-react-app` directory, run the commands: +
  `git stage .` +
  then +
  `git commit -m "Add 'Deliver' stage"`
. Go back to Jenkins again, log in again if necessary and ensure you've accessed
  Jenkins's Blue Ocean interface.
. Click *Run* at the top left, then quickly click the *OPEN* link which appears
  briefly at the lower-right to see Jenkins building your amended Pipeline
  project. If you weren't able to click the **OPEN** link, click the _top_ row
  on the Blue Ocean interface to access this feature. +
  If your amended Pipeline ran successfully, here's what the Blue Ocean
  interface should look like. Notice the additional "Deliver" stage. Click on
  the previous "Test" and "Build" stage circles to access the outputs from those
  stages. +
  image:tutorials/java-maven-23-deliver-stage-runs-successfully.png[alt="Deliver
  stage runs successfully",width=100%] +
  Here's what the output of the "Deliver" stage should look like, showing you
  the execution results of your Node.js/React application. +
  image:tutorials/java-maven-25-deliver-stage-output-only.png[alt="Deliver
  stage output only",width=100%]
. Click the *X* at the top-right to return to the main Blue Ocean interface,
  which lists your previous Pipeline runs in reverse chronological order. +
  image:tutorials/java-maven-26-main-blue-ocean-interface-with-all-previous-runs-displayed.png[alt="Main
  Blue Ocean interface with all previous runs displayed",width=100%]
